<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="./bower_components/raphael/raphael-min.js"></script>
    <style>
        html {background: #333}
        #status {
            position: absolute;
            top: 20px;
            left:20px;
            font: 100 36px Helvetica,Arial,sans-serif;
            color: #fff;
        }
    </style>
</head>
<body>

    <div id="status">Draw your dots...</div>
    <script>
        function Parallelogram(top, a, b) {
            this.top = top;
            this.a = a;
            this.b = b;

            this.center = a.getCenterBetween(b);
            this.bottom = this.center.getReflectionOf(top);
            this.area = getParallelogramArea(this.top, this.a, this.b);
        }

        function getParallelogramArea(top, a, b) {
            var at = a.distanceTo(top);
            var bt = b.distanceTo(top);
            var ab = a.distanceTo(b);

            /**
             * Calculus:
             *
             * ab = ah + bh
             * h^2 = at^2 - ah^2
             * h^2 = bt^2 - bh^2
             *
             * at^2 - ah^2 = bt^2 - (ab - ah)^2
             * at^2 - ah^2 = bt^2 - ab^2 + 2*ab*ah - ah^2
             *
             * @type {number}
             */
            var ah = (at * at - bt * bt + ab * ab) / (2 * ab);
            var height = Math.sqrt(at * at - ah * ah);

            return ab * height;
        }

        function Point(x, y) {
            this.x = x;
            this.y = y;
        }

        Point.prototype.getCenterBetween = function (point) {
            return new Point(
                (this.x + point.x) / 2,
                (this.y + point.y) / 2
            );
        };

        Point.prototype.getReflectionOf = function (point) {
            return new Point(
                2 * this.x - point.x,
                2 * this.y - point.y
            );
        };

        Point.prototype.distanceTo = function (point) {
            var xDiff = this.x - point.x;
            var yDiff = this.y - point.y;
            return Math.sqrt(xDiff * xDiff + yDiff * yDiff);
        };

        function CompactParallelogram(p1, p2, p3) {
            var d12 = p1.distanceTo(p2);
            var d23 = p2.distanceTo(p3);
            var d31 = p3.distanceTo(p1);
            var maxDistance = Math.max.call(null, d12, d23, d31);
            var top = maxDistance === d12
                ? p3
                : maxDistance === d23
                    ? p1
                    : p2;
            var base = [p1, p2, p3].filter(function (p) {
                return p !== top;
            });
            return new Parallelogram(top, base[0], base[1]);
        }

        Raphael.fn.enclosedPathByPoints = function (points) {
            var coordPairs = points.map(function (point) {
                return point.x + ',' + point.y;
            });
            return this.path('M' + coordPairs.join('L') + 'Z');
        };

        Raphael.fn.circleByPoint = function (center, radius) {
            return this.circle(center.x, center.y, radius || 1);
        };

        Raphael.el.paint = function (color) {
            return this.attr({
                stroke: null,
                fill: color
            });
        };

        var par = new Parallelogram(
            new Point(500, 200),
            new Point(200, 200),
            new Point(350, 360)
        );

        var paper = Raphael(0, 0, '100%', '100%');

        paper.circleByPoint(par.top, 11).paint('IndianRed');
        paper.circleByPoint(par.a, 11).paint('red');
        paper.circleByPoint(par.b, 11).paint('Crimson');

        paper.circleByPoint(par.bottom, 3).paint('lime');
        paper.circleByPoint(par.center).paint('yellow');

        var radius = Math.sqrt(par.area / Math.PI);
        paper.circleByPoint(par.center, radius).attr('stroke', 'yellow');
        paper.enclosedPathByPoints([par.b, par.bottom, par.a, par.top]).attr('stroke', 'lightblue');
    </script>
</body>
</html>
